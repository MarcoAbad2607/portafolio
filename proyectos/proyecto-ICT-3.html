<!doctype html>
<html lang="es" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ICT Digital Test ‚Äî Integraci√≥n de 4 esc√°neres Keyence</title>
  <meta name="description" content="Caso completo: Integraci√≥n de 4 esc√°neres Keyence al ICT (Digital Test) con candados de inicio y trazabilidad garantizada." />
  <meta name="theme-color" content="#f8fafc" id="themeColor">
  <link rel="icon" href="../img/favicon.ico">
  <style>
    /* =========== Paleta base (igual al index) =========== */
    :root{
      --bg:#f8fafc;           /* claro por defecto */
      --panel:#ffffff;
      --ink:#0b1220;
      --muted:#475569;
      --line:#cbd5e1;
      --acc:#22d3ee;          /* cian */
      --acc-2:#a78bfa;        /* violeta */
      --warn:#f59e0b;         /* √°mbar */
      --ok:#34d399;           /* verde */
      /* Copiar */
      --btn-copy-bg:#0f172a;  /* fondo bot√≥n copiar (claro) */
      --btn-copy-ink:#e6edf3; /* texto bot√≥n copiar (claro) */
      --code-bg:#0b1220;      /* fondo code en claro (oscuro suave) */
      --code-ink:#e6edf3;
      --chip-bg:#eef2ff;      /* chips breadcrumb claros */
      --chip-ink:#1e293b;
    }
    html[data-theme="dark"]{
      --bg:#0b1220;
      --panel:#0f172a;
      --ink:#e6edf3;
      --muted:#98a2b3;
      --line:#22314c;
      --btn-copy-bg:#1f2937;  /* fondo bot√≥n copiar en oscuro */
      --btn-copy-ink:#e5e7eb;
      --code-bg:#0a0f1a;
      --code-ink:#e6edf3;
      --chip-bg:#111827;
      --chip-ink:#e5e7eb;
    }

    *{box-sizing:border-box}
    html{height:100%;scroll-behavior:smooth}
    body{
      height:100%;margin:0;
      font-family:Inter,system-ui,-apple-system,Segoe UI,Roboto,Ubuntu,Arial,sans-serif;
      background:var(--bg);color:var(--ink)
    }
    a{color:var(--acc);text-decoration:none}
    a:hover{text-decoration:underline}
    img{max-width:100%;display:block}
    .wrap{max-width:1200px;margin:0 auto;padding:0 20px}

    /* =========== Header minimal, sticky =========== */
    header{position:sticky;top:0;z-index:50;background:rgba(248,250,252,.7);backdrop-filter:blur(10px);border-bottom:1px solid var(--line)}
    html[data-theme="dark"] header{ background:rgba(11,18,32,.6); }
    nav{display:flex;align-items:center;justify-content:space-between;height:64px}
    .brand{display:flex;align-items:center;gap:10px;font-weight:800;letter-spacing:.3px}
    .brand .dot{width:10px;height:10px;border-radius:50%;background:linear-gradient(90deg,var(--acc),var(--acc-2))}
    .btn{display:inline-flex;align-items:center;gap:8px;padding:10px 14px;border-radius:12px;background:var(--acc);color:#05131e;font-weight:700;border:none}
    .btn.ghost{background:transparent;border:1px solid var(--line);color:var(--ink)}
    .mode{background:transparent;border:1px solid var(--line);color:var(--ink);padding:6px 10px;border-radius:10px;margin-left:8px;cursor:pointer}

    /* Chips reutilizables */
    .chip{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 10px;border-radius:999px;border:1px solid var(--line);
      background:var(--chip-bg);color:var(--chip-ink);font-size:12.5px
    }

    /* Accesible focus */
    :where(a,button).btn:focus-visible,
    :where(.mode,.copy,#toTop,a,button):focus-visible{
      outline:2px solid var(--acc);outline-offset:2px
    }

    .btn.ghost:hover{background:rgba(0,0,0,.04)}
    html[data-theme="dark"] .btn.ghost:hover{background:rgba(255,255,255,.04)}

    /* =========== Hero (igual al index) =========== */
    .hero{position:relative;overflow:hidden}
    .hero .inner{display:grid;gap:24px;grid-template-columns:1.1fr .9fr;align-items:center;padding:36px 0 12px}
    .title{font-size:clamp(28px,4.5vw,48px);line-height:1.1;margin:0}
    .lead{color:var(--muted);margin:0}
    .cta{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
    .blob{
      position:absolute;inset:-20% auto auto -10%;width:60vw;height:60vw;filter:blur(80px);
      background:
        radial-gradient(circle at 30% 30%,rgba(34,211,238,.25),transparent 60%),
        radial-gradient(circle at 70% 60%,rgba(167,139,250,.22),transparent 60%);
      pointer-events:none
    }
    .avatar{width:140px;height:140px;border-radius:12px;border:2px solid var(--line);background:#0b1220;margin-left:auto;object-fit:cover}

    /* =========== Secciones y b√°sicos =========== */
    section{padding:28px 0;scroll-margin-top:80px}
    h2{font-size:22px;margin:0 0 12px}
    .muted{color:var(--muted)}
    .panel{background:var(--panel);border:1px solid var(--line);border-radius:16px;padding:16px}
    .grid{display:grid;gap:16px}
    .cards{grid-template-columns:repeat(auto-fit,minmax(280px,1fr))}
    .card{background:var(--panel);border:1px solid var(--line);border-radius:16px;overflow:hidden}
    .card img{width:100%;height:280px;object-fit:cover}
    .row{display:flex;flex-wrap:wrap;gap:8px}
    .tag{font-size:12px;color:var(--muted);border:1px solid var(--line);padding:6px 8px;border-radius:8px}

    /* =========== Breadcrumb con chips =========== */
    .crumbs{display:flex;align-items:center;gap:8px;flex-wrap:wrap;margin:12px 0}
    .crumbs a, .crumbs span[aria-current="page"]{
      display:inline-flex;align-items:center;gap:6px;
      padding:6px 12px;border-radius:999px;border:1px solid var(--line);
      background:var(--chip-bg);color:var(--chip-ink);text-decoration:none
    }
    .crumbs .sep{opacity:.5;color:var(--muted);padding:0 2px}

    /* =========== C√≥digo + bot√≥n copiar =========== */
    pre{
      position:relative;margin:0;padding:14px;border:1px solid var(--line);
      background:var(--code-bg);border-radius:12px;overflow:auto; padding-top:38px;
    }
    code{font-family:ui-monospace,SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;color:var(--code-ink);font-size:13.5px;white-space:pre}
    .copy{
      position:absolute;right:8px;top:8px;padding:7px 10px;border-radius:8px;border:1px solid var(--line);
      background:var(--btn-copy-bg);color:var(--btn-copy-ink);cursor:pointer;font-size:12px;box-shadow:0 1px 2px rgba(0,0,0,.25)
    }
    .copy:hover{opacity:.9}
    .copy:active{transform:scale(.98)}

    /* =========== Procedimiento realizado (steps) =========== */
    .steps{ display:grid; grid-template-columns:1fr; gap:16px; width:100%; margin:0; box-sizing:border-box; }
    .step{ position:relative; background:var(--panel); border:1px solid var(--line); border-radius:16px; padding:16px; box-sizing:border-box; overflow:hidden; }
    .step::before{ content:attr(data-step); position:absolute; left:16px; top:16px; width:28px; height:28px; border-radius:999px; display:grid; place-items:center; font-weight:700; background:linear-gradient(90deg,var(--acc),var(--acc-2)); color:#05131e; }
    .step h3{ margin:0 0 8px 44px; }
    @media (max-width: 900px){ .steps{ gap:12px; } .step{ padding:12px; } .step::before{ left:12px; top:12px; width:26px; height:26px; } .step h3{ margin:0 0 8px 44px; } }

    /* =========== ToTop + Footer =========== */
    #toTop{position:fixed;right:16px;bottom:16px;display:none;align-items:center;justify-content:center;width:42px;height:42px;border-radius:12px;background:var(--panel);border:1px solid var(--line);cursor:pointer}
    footer{border-top:1px solid var(--line);padding:20px 0;margin-top:24px;color:var(--muted)}
  </style>
</head>
<body>
  <!-- Header minimal -->
  <header>
    <div class="wrap">
      <nav>
        <div class="brand"><span class="dot"></span> <span>Marco A. Mu√±iz ‚Äî Proyecto</span></div>
        <div style="display:flex;align-items:center;gap:8px">
          <a class="btn ghost" href="../index.html#proyectos">‚Üê Volver</a>
          <button id="mode" class="mode" aria-label="Tema">‚òº</button>
        </div>
      </nav>
    </div>
  </header>

  <!-- Hero del proyecto -->
  <div class="hero">
    <div class="blob" aria-hidden="true"></div>
    <div class="wrap inner">
      <div>
        <span class="chip">Proyecto</span>
        <h1 class="title">ICT Digital Test ‚Äî Escaneo autom√°tico con 4 esc√°neres Keyence</h1>
        <p class="lead">Integraci√≥n de 4 esc√°neres Keyence a la secuencia del ICT (Digital Test) con <strong>candados</strong> de inicio y trazabilidad garantizada.</p>
        <div class="cta">
          <a class="btn" href="../index.html#proyectos">‚Üê Volver</a>
          <a class="btn ghost" href="#procedimiento">Ver procedimiento</a>
        </div>
      </div>
      <div>
        <img class="avatar" loading="lazy" decoding="async" alt="Imagen representativa del proyecto" src="../img/ICT-proyecto3-main.png" />
      </div>
    </div>
  </div>

  <!-- Breadcrumb -->
  <div class="wrap" style="margin-top:10px">
    <!-- Aviso de confidencialidad -->
<div class="panel" style="margin-bottom:20px; border-left:4px solid var(--warn); background:rgba(245,158,11,.08)">
  <p style="margin:0; font-size:14.5px; line-height:1.5; color:var(--muted)">
    üîí <strong>Aviso:</strong> Parte de la informaci√≥n t√©cnica y de negocio de la empresa ha sido 
    <u>omitida u ocultada</u> en este documento por motivos de 
    <strong>derechos de propiedad intelectual</strong> y confidencialidad.
  </p>
</div>

    <nav class="crumbs" aria-label="breadcrumb">
      <a href="../index.html">Inicio</a>
      <span class="sep">‚Ä∫</span>
      <a href="../index.html#proyectos">Proyectos</a>
      <span class="sep">‚Ä∫</span>
      <span aria-current="page">ICT ‚Äî Escaneo autom√°tico Keyence</span>
    </nav>
  </div>

  <!-- Contenido principal -->
  <main class="wrap">
    <!-- Resumen -->
    <section>
      <h2>Resumen</h2>
      <div class="panel">
        <p>
          La l√≠nea de ICT presentaba fallas intermitentes al <strong>leer el identificador</strong> de las piezas. Cuando no hab√≠a lectura, la pieza se probaba sin SN v√°lido y no se generaba <strong>trazabilidad</strong>, provocando rechazos en estaciones posteriores e incluso <em>scrap</em>.
        </p>
        <p>
          Se integraron <strong>4 esc√°neres Keyence</strong> (uno por carril/zona) a la secuencia del ICT y se implementaron <strong>candados</strong>: si no se obtiene un c√≥digo v√°lido, <u>no inicia</u> la prueba, se informa al operador y se registra el evento. Con ello, se asegura la trazabilidad y se reducen defectos aguas abajo.
        </p>
        <div class="row" style="margin-top:8px">
          <span class="tag">VB.NET</span>
          <span class="tag">Keysight i3070 (ICT)</span>
          <span class="tag">Keyence (esc√°ner)</span>
          <span class="tag">MES/IMES</span>
          <span class="tag">Trazabilidad</span>
        </div>
      </div>
    </section>

    <!-- Arquitectura -->
    <section>
      <h2>Arquitectura</h2>
      <ul>
        <li><strong>Equipo base:</strong> ICT Keysight i3070 (panel de 4 posiciones).</li>
        <li><strong>Esc√°neres:</strong> 4 dispositivos Keyence (1 por carril). Conexi√≥n seg√∫n entorno (TCP/IP o puerto COM).</li>
        <li><strong>Secuencia ICT:</strong> lectura ‚Üí validaci√≥n ‚Üí candado de inicio ‚Üí prueba ‚Üí posteo a trazabilidad.</li>
        <li><strong>Validaci√≥n:</strong> longitud/prefijo (ej. 29 caracteres, prefijo <code>P1782063-01-A</code>), opcional regex.</li>
        <li><strong>Operaci√≥n:</strong> lectura autom√°tica o formulario de captura manual con verificaci√≥n.</li>
      </ul>
      <div class="grid cards">
        <div class="card"><img loading="lazy" decoding="async" src="../img/ICT-keyence-arquitectura.png" alt="Arquitectura de integraci√≥n Keyence + ICT"></div>
        <div class="card"><img loading="lazy" decoding="async" src="../img/ICT-keyence-flujo.png" alt="Flujo de operaci√≥n"></div>
      </div>
    </section>

    <!-- Procedimiento realizado -->
    <section id="procedimiento">
      <h2>Procedimiento realizado</h2>
      <div class="steps">
        <!-- Paso 1 -->
        <article class="step" data-step="1">
          <h3>Diagn√≥stico y definici√≥n de reglas</h3>
          <p class="muted">Revisi√≥n de logs y puntos de falla: piezas sin trazabilidad por lecturas vac√≠as. Se definieron las reglas de validaci√≥n (longitud y prefijo) y mensajes operativos.</p>
          <ul>
            <li>Longitud esperada: <code>29</code> caracteres.</li>
            <li>Prefijo permitido: <code>P1782063-01-A</code>.</li>
            <li>Mensajes al operador: bloqueo de inicio + indicaci√≥n de retirar/separar pieza.</li>
          </ul>
        </article>

        <!-- Paso 2 -->
        <article class="step" data-step="2">
          <h3>Integraci√≥n de hardware (4 esc√°neres)</h3>
          <p class="muted">Asignaci√≥n de un esc√°ner por carril/posici√≥n. Abstracci√≥n de puertos/hosts en configuraci√≥n para facilitar mantenimiento.</p>
          <pre><button class="copy" data-copy>Copiar</button><code>// Ejemplo: mapeo de puertos COM / IP por carril
// Board 1..4 ‚Üí √≠ndice 0..3
dim _BarcodeScannerCOMPorts = {"COM3","COM4","COM5","COM6"}
// o TCP/IP: {"10.0.0.21","10.0.0.22","10.0.0.23","10.0.0.24"}</code></pre>
        </article>

        <!-- Paso 3 -->
        <article class="step" data-step="3">
          <h3>Lectura y validaci√≥n antes de cerrar la fixtura</h3>
          <p class="muted">Se lee el c√≥digo para cada posici√≥n habilitada. Si alguna lectura es inv√°lida, no se cierra la fixtura ni se activa vac√≠o; se informa al operador.</p>
          <pre><button class="copy" data-copy>Copiar</button><code>' Fragmento de Run(): lectura previa a la prueba
Dim barcodepiezas(3) As String
Dim allScansOk As Boolean = True
For Each nBoardNumber As Short In {1S,2S,3S,4S}
  If Not m_TPForm.PanelCtrl1._ShouldTestBoard(nBoardNumber-1) Then Continue For
  Dim barcode As String = ""
  ' Autom√°tico (ReadBarcode) o manual (Escaneo_Manual)
  Dim form As New Escaneo_Manual(nBoardNumber.ToString())
  If form.ShowDialog() = DialogResult.OK Then barcode = form.ReturnValue
  If Not IsValidBarcode(barcode) Then
    ShowScanError(nBoardNumber) : allScansOk = False : Exit For
  End If
  barcodepiezas(nBoardNumber-1) = barcode
Next
If Not allScansOk Then GoTo CleanExit</code></pre>
        </article>

        <!-- Paso 4 -->
        <article class="step" data-step="4">
          <h3>Candado de inicio y mensajes al operador</h3>
          <p class="muted">Si no hay lectura v√°lida, se bloquea el inicio con mensaje claro (pieza y panel). Con lectura v√°lida, se procede a cerrar fixtura y activar vac√≠o.</p>
          <pre><button class="copy" data-copy>Copiar</button><code>Sub ShowScanError(n As Short)
  Dim panel = If(n &lt; 3, 1, 2)
  MessageBox.Show($"NO SE PUDO LEER EL SERIAL DE LA PIEZA: {n} DEL PANEL: {panel}")
  MessageBox.Show("POR FAVOR, RETIRE PIEZA Y SEP√ÅRELA.\nNO SE SUBI√ì NING√öN DATO A MES, POR FAVOR, REINTEGTE:")
End Sub</code></pre>
        </article>

        <!-- Paso 5 -->
        <article class="step" data-step="5">
          <h3>Ejecuci√≥n de prueba y trazabilidad</h3>
          <p class="muted">Con serial v√°lido por posici√≥n: SetUUTinfo ‚Üí BoardInit ‚Üí Main_Test ‚Üí BoardTerminate. Se postea a trazabilidad junto con el serial.</p>
          <pre><button class="copy" data-copy>Copiar</button><code>UpdateOperatorMessages("Cerrar Fixtura")
WaitForCoverToClose()
CITEKernel.Delay("100ms")
UpdateOperatorMessages("Probando PCB's")
CITEKernel.Vac1_On() : CITEKernel.Delay("1s")
For Each n In {1S,2S,3S,4S}
  If Not m_TPForm.PanelCtrl1._ShouldTestBoard(n-1) Then Continue For
  Dim ret = SetUUTinfo(n, barcodepiezas(n-1))
  BoardInit(n) : If ret = 0 Then Main_Test(n)
  If (CITEKernel.GetGlobalFail = 0) AndAlso (CITEKernel.GetSkipFlag() = 0) Then
    BoardTerminate(n)
  Else
    ' Retesteo opcional (re-asentar)
  End If
Next</code></pre>
        </article>

        <!-- Paso 6 -->
        <article class="step" data-step="6">
          <h3>Captura manual validada (fallback)</h3>
          <p class="muted">Formulario con validaci√≥n local: longitud 29 y prefijo <code>P1782063-01-A</code>; Enter confirma, Esc cancela.</p>
          <pre><button class="copy" data-copy>Copiar</button><code>' Escaneo_Manual (resumen)
Private Const LEN_OK = 29
Private Const PREFIJO = "P1782063-01-A"
Function IsValidSerial(s As String) As Boolean
  If String.IsNullOrWhiteSpace(s) Then Return False
  s = s.Trim().Replace(vbCr, "").Replace(vbLf, "")
  Return s.Length = LEN_OK AndAlso s.StartsWith(PREFIJO, StringComparison.OrdinalIgnoreCase)
End Function</code></pre>
        </article>

        <!-- Paso 7 -->
        <article class="step" data-step="7">
          <h3>Registro y evidencias</h3>
          <p class="muted">Se guardan logs de lectura (OK/NG), tiempos y esc√°ner/carril. Los datos sensibles del cliente han sido omitidos.</p>
          <p class="muted"><strong>Aviso:</strong> Informaci√≥n propietaria de la empresa ha sido omitida u ocultada por derechos de propiedad intelectual.</p>
        </article>
      </div>
    </section>

    <!-- Galer√≠a -->
    <section>
      <h2>Galer√≠a</h2>
      <div class="grid cards">
        <div class="card"><img loading="lazy" decoding="async" src="../img/ICT-keyence-captura1.png" alt="HMI de escaneo"></div>
        <div class="card"><img loading="lazy" decoding="async" src="../img/ICT-keyence-captura2.png" alt="Logs de lectura"></div>
		<div class="card"><img loading="lazy" decoding="async" src="../img/ICT-keyence-captura3.png" alt="Panel PASS"></div>
      </div>
    </section>

    <!-- Detalles t√©cnicos -->
    <section>
      <h2>Detalles t√©cnicos</h2>
      <div class="panel">
        <ul>
          <li>Lenguajes/Frameworks: VB.NET (Windows Forms), integraci√≥n con ICT i3070.</li>
          <li>Integraciones: Keyence (COM/TCP), Testplan ICT, MES/IMES.</li>
          <li>Validaci√≥n: longitud + prefijo; opcional Regex seg√∫n modelo.</li>
          <li>Operaci√≥n: lectura autom√°tica con reintentos o captura manual validada.</li>
        </ul>
      </div>
    </section>

    <!-- Resultados -->
    <section>
      <h2>Resultados</h2>
      <div class="panel">
        <ul>
          <li><strong>0%</strong> pruebas sin trazabilidad por falta de lectura.</li>
          <li>Reducci√≥n de <em>scrap</em> y retrabajos en estaciones subsecuentes.</li>
          <li>Mejor tiempo de diagn√≥stico gracias a mensajes claros al operador.</li>
        </ul>
      </div>
    </section>
  </main>

  <!-- Bot√≥n subir -->
  <div id="toTop">‚ñ≤ Arriba</div>

  <!-- Footer -->
  <footer>
    <div class="wrap">¬© <span id="year"></span> Marco Antonio Mu√±iz Abad ¬∑ Hecho con HTML/CSS/JS ¬∑ Publicado en GitHub Pages</div>
  </footer>

  <script>
    // A√±o din√°mico
    document.getElementById('year').textContent = new Date().getFullYear();

    // ===== Tema: claro por defecto; respeta preferencia guardada =====
    const modeBtn = document.getElementById('mode');
    const themeMeta = document.getElementById('themeColor');
    function applyTheme(isDark){
      document.documentElement.dataset.theme = isDark ? 'dark' : 'light';
      if (modeBtn) modeBtn.textContent = isDark ? 'üåô' : '‚òÄÔ∏è';
      if (themeMeta) themeMeta.setAttribute('content', isDark ? '#0b1220' : '#f8fafc');
    }
    (function initTheme(){
      const saved = localStorage.getItem('theme');
      const isDark = saved ? (saved === 'dark') : false; // claro por defecto
      applyTheme(isDark);
    })();
    if (modeBtn){
      modeBtn.addEventListener('click', ()=>{
        const nowDark = (document.documentElement.dataset.theme !== 'dark');
        applyTheme(nowDark);
        localStorage.setItem('theme', nowDark ? 'dark' : 'light');
      });
    }

    // ===== Bot√≥n copiar en bloques de c√≥digo =====
    document.querySelectorAll('[data-copy]').forEach(btn=>{
      btn.addEventListener('click', ()=>{
        const code = btn.nextElementSibling?.innerText || '';
        navigator.clipboard.writeText(code).then(()=>{
          const old = btn.textContent;
          btn.textContent = '¬°Copiado!';
          setTimeout(()=> btn.textContent = old, 1200);
        });
      });
    });

    // ===== Bot√≥n subir =====
    const toTop = document.getElementById('toTop');
    window.addEventListener('scroll', ()=>{
      toTop.style.display = window.scrollY > 500 ? 'inline-flex' : 'none';
    });
    toTop.addEventListener('click', ()=>window.scrollTo({top:0,behavior:'smooth'}));
  </script>
</body>
</html>
